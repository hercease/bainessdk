(()=>{const n="https://assetfinance.bainescredit.com/sdk/dist/popup.html";document.addEventListener("DOMContentLoaded",(function(){const e=document.createElement("div"),t=e.attachShadow({mode:"open"}),o=document.createElement("style");o.textContent="\n        .custom-modal-backdrop {\n            position: fixed;\n            top: 0; left: 0;\n            width: 100vw;\n            height: 100vh;\n            background: rgba(0, 0, 0, 0.5);\n            z-index: 9999;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n        }\n\n        .custom-modal {\n            background: #fff;\n            width: 90%;\n            max-width: 400px;\n            border-radius: 8px;\n            overflow: hidden;\n            box-shadow: 0 5px 20px rgba(0,0,0,0.3);\n            animation: fadeIn 0.3s ease-out;\n        }\n\n        .custom-modal-header {\n            padding: 1rem;\n            background: #f5f5f5;\n            border-bottom: 1px solid #ddd;\n            display: flex;\n            align-items: center;\n            justify-content: space-between;\n        }\n\n        .custom-modal-title {\n            margin: 0;\n            font-size: 1rem;\n            font-weight: 600;\n            display: flex;\n            align-items: center;\n            gap: 0.5rem;\n        }\n\n        .custom-close {\n            background: none;\n            border: none;\n            font-size: 1.5rem;\n            cursor: pointer;\n        }\n\n        .custom-modal-body {\n            padding: 0;\n        }\n\n        .alert {\n            padding: 10px;\n            color: #fff;\n            background: #dc3545;\n            display: none;\n            text-align: center;\n        }\n\n        .spinner {\n            text-align: center;\n            padding: 1rem;\n            display: none;\n        }\n\n        .spinner div {\n            width: 2rem;\n            height: 2rem;\n            border: 4px solid #007bff;\n            border-top-color: transparent;\n            border-radius: 50%;\n            animation: spin 1s linear infinite;\n            margin: auto;\n        }\n\n        @keyframes spin {\n            to { transform: rotate(360deg); }\n        }\n\n        @keyframes fadeIn {\n            from { opacity: 0; transform: scale(0.95); }\n            to { opacity: 1; transform: scale(1); }\n        }\n    ",t.appendChild(o);const i=document.createElement("div");i.innerHTML='\n        <div id="customModalBackdrop" class="custom-modal-backdrop" style="display: none;">\n            <div class="custom-modal">\n                <div class="custom-modal-header">\n                    <h6 class="custom-modal-title">\n                        <img src="https://assetfinance.bainescredit.com/public/main/img/favicon.ico" style="height: 20px;"/>\n                        BainesCredit Asset Finance\n                    </h6>\n                    <button class="custom-close" id="customCloseBtn">&times;</button>\n                </div>\n                <div class="custom-modal-body">\n                    <div id="errorMessage" class="alert"></div>\n                    <div id="loader" class="spinner"><div></div></div>\n                    <iframe id="popupFrame" src="" style="width: 100%; height: 400px; border: none;"></iframe>\n                </div>\n            </div>\n        </div>\n    ',t.appendChild(i),document.body.appendChild(e);const a=t.querySelector("#customModalBackdrop"),s=t.querySelector("#customCloseBtn"),r=t.querySelector("#popupFrame"),d=t.querySelector("#errorMessage"),c=t.querySelector("#loader");s.addEventListener("click",(()=>{a.style.display="none"}));let l=null;window.openPaymentPopup=async function(e,t){d.style.display="none",c.style.display="block";const{merchant_email:o,api_key:i,products:s}=e;let p=[],m=0;if(Array.isArray(s)&&0!==s.length)for(let n of s){if(!n.price||isNaN(n.price)){p.push("Each product must have a valid price.");break}m+=n.price*(n.quantity||1)}else p.push("No products provided.");if(i||p.push("API key is required."),o&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o)||p.push("Valid merchant email required."),(isNaN(m)||m<=0)&&p.push("Total price must be positive."),p.length>0)return d.innerHTML=`Error:<br>${p.join("<br>")}`,d.style.display="block",void(c.style.display="none");const u=await async function(n,e){const t=`https://assetfinance.bainescredit.com/fetchsettings?${new URLSearchParams({amount:e}).toString()}`;try{const e=await fetch(t,{method:"GET",headers:{Authorization:"Bearer "+n,"Content-Type":"application/json"}}),o=await e.json();return o.origin=window.location.origin,e.ok&&!1!==o.status?o:(d.textContent=o.message||"An error occurred.",d.style.display="block",null)}catch(n){return console.error("API Error:",n),d.textContent="Failed to fetch payment settings.",d.style.display="block",null}}(i,m);if(c.style.display="none",!u)return;const{period:y=0,interest_amount:f=0,insurance_amount:h=0,insurance:g=0}=u;r.src=n,a.style.display="flex",l&&window.removeEventListener("message",l),r.onload=()=>{r.contentWindow.postMessage({merchant_email:o,products:s,interest_rate:f,insurance_amount:h,insurance:g,period:y,total_price:m},"*")},window.paymentCallback=t,l=function(e){if(e.origin!==new URL(n).origin)return;const t=e.data;!0===t?.status&&"function"==typeof window.paymentCallback&&(window.paymentCallback(t),a.style.display="none")},window.addEventListener("message",l)}}))})();